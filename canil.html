<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Canil My Baby</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --spitz: #ff9f43; --bengal: #54a0ff; --bg: #f8f9fa;
            --dark: #2d3436; --danger: #ff4757;
        }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 12px; color: var(--dark); }
        .container { max-width: 500px; margin: auto; }
        header { text-align: center; padding: 10px 0 15px; }
        header h2 { margin: 0; font-size: 20px; color: var(--dark); letter-spacing: -0.5px; }
        header small { color: #636e72; font-weight: bold; text-transform: uppercase; font-size: 11px; letter-spacing: 1px; }

        .card-meta { 
            background: linear-gradient(135deg, #2d3436 0%, #000000 100%); 
            color: white; padding: 20px; border-radius: 24px; margin-bottom: 15px; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        .meta-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .meta-title { font-size: 11px; font-weight: bold; opacity: 0.8; }
        .meta-value-container { display: flex; align-items: center; background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 12px; }
        .meta-input { background: transparent; border: none; color: white; width: 80px; font-weight: bold; font-size: 16px; outline: none; text-align: right; }
        
        .progress-container { background: rgba(255,255,255,0.1); height: 10px; border-radius: 10px; overflow: hidden; margin: 12px 0; }
        .progress-bar { background: linear-gradient(90deg, var(--spitz), #ffcd3c); height: 100%; width: 0%; transition: 1.5s ease; }
        .meta-footer { display: flex; justify-content: space-between; font-size: 11px; font-weight: bold; }

        /* AJUSTE DO GRAFICO E MEDIA EMBAIXO */
        .chart-container { background: white; padding: 15px; border-radius: 24px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); display: flex; flex-direction: column; }
        .chart-wrapper { height: 160px; position: relative; }
        .media-tag { align-self: flex-end; margin-top: 10px; background: #f1f2f6; padding: 4px 12px; border-radius: 8px; font-size: 10px; font-weight: bold; color: #636e72; border: 1px solid #eee; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-card { background: white; padding: 12px; border-radius: 20px; text-align: center; border: 1px solid rgba(0,0,0,0.02); }
        .stat-card small { color: #b2bec3; display: block; font-size: 9px; text-transform: uppercase; font-weight: 800; margin-bottom: 4px; }
        .stat-card strong { font-size: 15px; }

        .form-venda { background: white; padding: 20px; border-radius: 24px; display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .row { display: flex; gap: 8px; }
        input, select { padding: 12px; border: 1px solid #edf2f7; background: #f8fafc; border-radius: 14px; font-size: 14px; outline: none; width: 100%; box-sizing: border-box; }
        
        button.btn-add { background: var(--dark); color: white; border: none; padding: 15px; border-radius: 14px; font-weight: bold; cursor: pointer; }
        .btn-vale { background: #fff5f5; color: var(--danger); border: 1px solid #ffe3e3; padding: 10px; border-radius: 12px; font-weight: bold; font-size: 11px; cursor: pointer; }

        .venda-card { background: white; padding: 15px; border-radius: 18px; margin-bottom: 10px; display: flex; align-items: center; border-left: 6px solid #ccc; font-size: 12px; gap: 10px; }
        .venda-info { flex-grow: 1; }
        .venda-valor { text-align: right; min-width: 90px; }
        .venda-Spitz { border-left-color: var(--spitz); }
        .venda-Bengal { border-left-color: var(--bengal); }
        .venda-Vale { border-left-color: var(--danger); background: #fffcfc; }
        .del-btn { border: none; background: #f1f2f6; color: #b2bec3; border-radius: 50%; width: 26px; height: 26px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h2>Painel de Vendas Canil My Baby</h2>
        <small>Gerson</small>
    </header>

    <div class="card-meta">
        <div class="meta-header">
            <div>
                <div class="meta-title">OBJETIVO DO M&#202;S</div>
                <div id="countdownTxt" style="font-size: 10px; margin-top: 4px; opacity: 0.7;"></div>
            </div>
            <div class="meta-value-container">
                <span style="font-size: 10px; opacity: 0.7; margin-right: 5px;">R$</span>
                <input type="number" id="metaVal" class="meta-input" onchange="salvarMeta()">
                <span style="margin-left:5px;">&#127919;</span>
            </div>
        </div>
        
        <div class="progress-container"><div id="barraProgresso" class="progress-bar"></div></div>
        
        <div class="meta-footer">
            <div>TOTAL <span id="porcentoTxt">0%</span></div>
            <div id="faltaTxt">...</div>
        </div>
    </div>

    <div class="chart-container">
        <div class="chart-wrapper">
            <canvas id="meuGrafico"></canvas>
        </div>
        <div class="media-tag">M&#201;DIA / VENDA: <span id="valorMedia">R$ 0</span></div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <small>Faturamento</small>
            <strong id="totalVendas">R$ 0,00</strong>
            <div id="faltaPerc" style="font-size: 8px; font-weight: bold; margin-top: 4px;"></div>
        </div>
        <div class="stat-card">
            <small>L&#237;quido a Receber</small>
            <strong id="totalComissao" style="color: #2ecc71;">R$ 0,00</strong>
            <div id="subVale" style="font-size: 8px; color: var(--danger); font-weight: bold;"></div>
        </div>
        <div class="stat-card">
            <small>Machos</small>
            <strong id="countMacho">0</strong>
            <div style="font-size:8px; opacity: 0.6;">&#128054;<span id="mS">0</span> | &#128049;<span id="mB">0</span></div>
        </div>
        <div class="stat-card">
            <small>F&#234;meas</small>
            <strong id="countFemea">0</strong>
            <div style="font-size:8px; opacity: 0.6;">&#128054;<span id="fS">0</span> | &#128049;<span id="fB">0</span></div>
        </div>
    </div>

    <div class="form-venda">
        <div class="row">
            <select id="tipo" style="flex:1.2">
                <option value="Spitz">&#128054; Spitz</option>
                <option value="Bengal">&#128049; Bengal</option>
            </select>
            <select id="sexo" style="flex:1">
                <option value="Macho">&#9794; Macho</option>
                <option value="F&#234;mea">&#9792; F&#234;mea</option>
            </select>
        </div>
        <input type="text" id="cliente" placeholder="Nome do Cliente">
        <input type="number" id="valorVenda" placeholder="Valor da Venda (R$)">
        <button class="btn-add" onclick="adicionarVenda()">REGISTRAR VENDA</button>
        
        <div class="row" style="margin-top: 5px;">
            <input type="number" id="valorVale" placeholder="R$ Vale" style="flex: 1;">
            <input type="text" id="motivoVale" placeholder="Motivo" style="flex: 1.5;">
            <button class="btn-vale" onclick="adicionarVale()">VALE</button>
        </div>
    </div>

    <div id="lista"></div>
    <button onclick="limparTudo()" style="background:none; color:#ccc; width:100%; border:none; margin:30px 0; cursor:pointer; font-size:10px; font-weight: bold;">ZERAR TUDO</button>
</div>

<script>
    let vendas = JSON.parse(localStorage.getItem('vendasV5')) || [];
    let meta = localStorage.getItem('metaV5') || 0;
    let chartInstance = null;

    document.getElementById('metaVal').value = meta;

    function salvarMeta() {
        meta = document.getElementById('metaVal').value;
        localStorage.setItem('metaV5', meta);
        renderizar();
    }

    function adicionarVenda() {
        const t = document.getElementById('tipo').value;
        const s = document.getElementById('sexo').value;
        const c = document.getElementById('cliente').value;
        const v = parseFloat(document.getElementById('valorVenda').value);
        if(c && v) {
            const hoje = new Date().toLocaleDateString('pt-BR').substring(0,5);
            vendas.push({ tipo:t, sexo:s, cliente:c, valor:v, data: hoje, isVale: false });
            localStorage.setItem('vendasV5', JSON.stringify(vendas));
            document.getElementById('cliente').value = '';
            document.getElementById('valorVenda').value = '';
            renderizar();
        }
    }

    function adicionarVale() {
        const m = document.getElementById('motivoVale').value || "Vale";
        const v = parseFloat(document.getElementById('valorVale').value);
        if(v) {
            const hoje = new Date().toLocaleDateString('pt-BR').substring(0,5);
            vendas.push({ tipo:'Vale', cliente: m, valor: v, data: hoje, isVale: true });
            localStorage.setItem('vendasV5', JSON.stringify(vendas));
            document.getElementById('motivoVale').value = '';
            document.getElementById('valorVale').value = '';
            renderizar();
        }
    }

    function excluir(i) {
        if(confirm("Excluir registro?")) {
            vendas.splice(i, 1);
            localStorage.setItem('vendasV5', JSON.stringify(vendas));
            renderizar();
        }
    }

    function renderizar() {
        const listaDiv = document.getElementById('lista');
        let totalFat = 0, mS=0, mB=0, fS=0, fB=0, totalVales = 0, qtdVendasReal = 0;
        let dadosGrafico = {};
        listaDiv.innerHTML = '';

        vendas.forEach((v, i) => {
            let val = v.valor || 0;
            if(v.isVale) {
                totalVales += val;
                listaDiv.innerHTML = `
                    <div class="venda-card venda-Vale">
                        <div class="venda-info"><strong>&#128184; ${v.cliente}</strong><br><small>Adiantamento</small></div>
                        <div class="venda-valor"><strong style="color:var(--danger)">- R$ ${val.toLocaleString()}</strong></div>
                        <button class="del-btn" onclick="excluir(${i})">&times;</button>
                    </div>` + listaDiv.innerHTML;
            } else {
                totalFat += val;
                qtdVendasReal++;
                dadosGrafico[v.data] = (dadosGrafico[v.data] || 0) + val;
                if(v.sexo && v.sexo.includes('Macho')) { v.tipo.includes('Spitz') ? mS++ : mB++; }
                else { v.tipo.includes('Spitz') ? fS++ : fB++; }
                const pIcon = v.tipo.includes('Spitz') ? '&#128054;' : '&#128049;';
                listaDiv.innerHTML = `
                    <div class="venda-card venda-${v.tipo.replace(/[^a-zA-Z]/g, "")}">
                        <div class="venda-info"><strong>${pIcon} ${v.cliente}</strong><br><small>${v.tipo} | ${v.sexo}</small></div>
                        <div class="venda-valor"><strong>R$ ${val.toLocaleString()}</strong><br><small style="color:#2ecc71">Com: R$ ${(val*0.03).toFixed(2)}</small></div>
                        <button class="del-btn" onclick="excluir(${i})">&times;</button>
                    </div>` + listaDiv.innerHTML;
            }
        });

        const hoje = new Date();
        const ultimoDia = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0).getDate();
        const diasFaltam = ultimoDia - hoje.getDate();
        document.getElementById('countdownTxt').innerHTML = "Faltam " + diasFaltam + " dias para o fim do m&#234;s";

        let comissaoBruta = (totalFat * 0.03) + 2000;
        document.getElementById('totalVendas').innerText = "R$ " + totalFat.toLocaleString();
        document.getElementById('totalComissao').innerText = "R$ " + (comissaoBruta - totalVales).toLocaleString();
        document.getElementById('subVale').innerText = totalVales > 0 ? "DESCONTADO: R$ " + totalVales.toLocaleString() : "SEM DESCONTOS";
        
        // VOLTANDO PARA MEDIA POR VENDA
        const mediaVenda = qtdVendasReal > 0 ? totalFat / qtdVendasReal : 0;
        document.getElementById('valorMedia').innerText = "R$ " + Math.round(mediaVenda).toLocaleString();

        document.getElementById('countMacho').innerText = mS + mB;
        document.getElementById('countFemea').innerText = fS + fB;
        document.getElementById('mS').innerText = mS; document.getElementById('mB').innerText = mB;
        document.getElementById('fS').innerText = fS; document.getElementById('fB').innerText = fB;

        const p = meta > 0 ? (totalFat / meta) * 100 : 0;
        document.getElementById('barraProgresso').style.width = Math.min(p, 100) + "%";
        document.getElementById('porcentoTxt').innerText = Math.floor(p) + "%";
        
        if(meta > 0) {
            document.getElementById('faltaTxt').innerText = meta - totalFat > 0 ? "FALTA R$ " + (meta-totalFat).toLocaleString() : "META BATIDA! &#127942;";
            document.getElementById('faltaPerc').innerText = (100-p) > 0 ? "FALTAM " + Math.ceil(100-p) + "%" : "META ATINGIDA";
            document.getElementById('faltaPerc').style.color = (100-p) > 0 ? "#ff4757" : "#2ecc71";
        }

        const ctx = document.getElementById('meuGrafico').getContext('2d');
        if(chartInstance) chartInstance.destroy();
        chartInstance = new Chart(ctx, {
            type: 'line',
            data: { 
                labels: Object.keys(dadosGrafico), 
                datasets: [{ 
                    data: Object.values(dadosGrafico), 
                    borderColor: '#54a0ff', 
                    backgroundColor: 'rgba(84, 160, 255, 0.05)',
                    fill: true,
                    tension: 0.4,
                    borderWidth: 4,
                    pointRadius: 3,
                    pointBackgroundColor: '#54a0ff'
                }] 
            },
            options: { 
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } }, 
                scales: { 
                    y: { display: false }, 
                    x: { grid: { display: false }, ticks: { font: { size: 9, weight: 'bold' }, color: '#b2bec3' } } 
                } 
            }
        });
    }

    function limparTudo() { if(confirm("Zerar todos os dados?")) { localStorage.clear(); location.reload(); } }
    renderizar();
</script>
</body>
</html>
