<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Baby - Sistema Profissional</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f0f2f5; 
            color: #1a1a1a; 
            margin: 0; 
            padding: 20px; 
        }
        .container { 
            max-width: 900px; 
            margin: auto; 
            background: #ffffff; 
            padding: 30px; 
            border-radius: 16px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); 
        }
        
        h1 { text-align: left; color: #1a1a1a; font-weight: 800; letter-spacing: -1px; margin-bottom: 25px; }

        /* DASHBOARD */
        .dashboard { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .card { 
            padding: 20px; 
            border-radius: 12px; 
            background: #f8f9fa; 
            border: 1px solid #eee;
        }
        .card h3 { margin: 0; font-size: 12px; text-transform: uppercase; color: #666; letter-spacing: 1px; }
        .card p { margin: 10px 0 0; font-size: 24px; font-weight: 800; }
        .card.destaque { background: #1a1a1a; color: #fff; }
        .card.destaque .valor { color: #00ff88; }

        /* GRAFICO */
        .chart-container { 
            background: #fff; 
            padding: 20px; 
            border-radius: 12px; 
            border: 1px solid #eee; 
            margin-bottom: 30px;
            height: 250px;
        }

        /* FORMULARIO */
        .form-box { 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr auto; 
            gap: 10px; 
            margin-bottom: 20px; 
        }
        input, select { 
            padding: 12px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            font-size: 14px; 
            outline: none;
        }
        input:focus { border-color: #00d2ff; }
        
        .btn-add { background: #1a1a1a; color: white; padding: 12px 25px; font-weight: 700; border: none; border-radius: 8px; cursor: pointer; }
        .btn-vale { background: #fff; color: #ff004c; border: 1px solid #ff004c; padding: 10px; width: 100%; border-radius: 8px; font-weight: 700; cursor: pointer; margin-bottom: 20px; }

        /* TABELA */
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; border-bottom: 2px solid #f0f0f0; color: #666; font-size: 12px; text-transform: uppercase; }
        td { padding: 15px; border-bottom: 1px solid #f0f0f0; font-size: 14px; }
        
        .row-vale { background-color: #fffafa; }
        .tag { padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 800; }
        .tag-cancel { background: #ffe5ec; color: #ff004c; }
        .tag-ok { background: #e5ffed; color: #00a344; }
        
        .btn-acao { 
            padding: 6px 10px; 
            border-radius: 6px; 
            border: 1px solid #ddd; 
            background: #fff; 
            cursor: pointer; 
            font-size: 12px;
            margin-left: 5px;
        }
        .btn-del:hover { background: #ff004c; color: #fff; border-color: #ff004c; }

        /* META */
        .meta-info { display: flex; justify-content: space-between; font-size: 12px; font-weight: 700; margin-bottom: 8px; }
        .meta-bg { background: #eee; height: 8px; border-radius: 10px; margin-bottom: 25px; overflow: hidden; }
        .meta-fill { background: linear-gradient(90deg, #00d2ff, #00ff88); height: 100%; width: 0%; transition: 1s; }
    </style>
</head>
<body>

<div class="container">
    <h1>Controle My Baby</h1>

    <div class="dashboard">
        <div class="card">
            <h3>Faturamento Ativo</h3>
            <p id="fatDisplay">R$ 0,00</p>
        </div>
        <div class="card destaque">
            <h3>Meu Saldo Final</h3>
            <p class="valor" id="saldoDisplay">R$ 0,00</p>
            <small id="comissaoInfo" style="font-size: 10px; opacity: 0.8;">Comiss√µes: R$ 0,00</small>
        </div>
        <div class="card">
            <h3>Vales Retirados</h3>
            <p style="color: #ff004c;" id="valesDisplay">R$ 0,00</p>
        </div>
    </div>

    <div class="meta-wrap">
        <div class="meta-info">
            <span id="metaStatus">Progresso da Meta</span>
            <span id="metaPct">0%</span>
        </div>
        <div class="meta-bg"><div class="meta-fill" id="metaBarra"></div></div>
    </div>

    <div class="chart-container">
        <canvas id="graficoBonito"></canvas>
    </div>

    <div class="form-box">
        <select id="tipo">
            <option value="Spitz Alem√£o">üê∂ Spitz Alem√£o</option>
            <option value="Gato Bengal">üê± Gato Bengal</option>
        </select>
        <input type="text" id="cliente" placeholder="Nome do Cliente">
        <input type="number" id="valor" placeholder="Valor R$">
        <button class="btn-add" onclick="adicionarVenda()">Lan√ßar Venda</button>
    </div>
    <button class="btn-vale" onclick="adicionarVale()">+ Registrar Vale ou Saque</button>

    <table>
        <thead>
            <tr>
                <th>Data</th>
                <th>Cliente / Pet</th>
                <th>Valor Bruto</th>
                <th>Minha Parte (3%)</th>
                <th>A√ß√µes</th>
            </tr>
        </thead>
        <tbody id="corpoTabela"></tbody>
    </table>
</div>

<script>
    let vendas = JSON.parse(localStorage.getItem('vendasV5')) || [];
    let metaMensal = 74000;
    let chart = null;

    function salvar() {
        localStorage.setItem('vendasV5', JSON.stringify(vendas));
        renderizar();
    }

    function adicionarVenda() {
        const cli = document.getElementById('cliente').value;
        const val = parseFloat(document.getElementById('valor').value);
        if(cli && val) {
            vendas.push({
                data: new Date().toLocaleDateString('pt-BR').substring(0, 5),
                cliente: cli,
                tipo: document.getElementById('tipo').value,
                valor: val,
                cancelada: false,
                isVale: false
            });
            document.getElementById('cliente').value = '';
            document.getElementById('valor').value = '';
            salvar();
        }
    }

    function adicionarVale() {
        const val = prompt("Valor do vale:");
        if(val) {
            vendas.push({
                data: new Date().toLocaleDateString('pt-BR').substring(0, 5),
                cliente: "VALE / RETIRADA",
                valor: parseFloat(val),
                isVale: true
            });
            salvar();
        }
    }

    function toggleCancel(i) {
        vendas[i].cancelada = !vendas[i].cancelada;
        salvar();
    }

    function deletar(i) {
        if(confirm("Excluir registro?")) {
            vendas.splice(i, 1);
            salvar();
        }
    }

    function renderizar() {
        const corpo = document.getElementById('corpoTabela');
        corpo.innerHTML = '';
        
        let totalComissao = 0;
        let totalVales = 0;
        let faturamentoAtivo = 0;
        let dadosGrafico = {};

        // Processamento reverso para mostrar os mais novos primeiro
        [...vendas].reverse().forEach((v, originalIndex) => {
            const i = vendas.length - 1 - originalIndex;

            if(v.isVale) {
                totalVales += v.valor;
                corpo.innerHTML += `
                    <tr class="row-vale">
                        <td>${v.data}</td>
                        <td style="color: #ff004c; font-weight: bold;">üí∏ VALE</td>
                        <td style="color: #ff004c;">- R$ ${v.valor.toLocaleString()}</td>
                        <td>-</td>
                        <td><button class="btn-acao btn-del" onclick="deletar(${i})">üóëÔ∏è</button></td>
                    </tr>`;
            } else {
                // REGRA: 3% de TODAS as vendas da lista
                const comissao = v.valor * 0.03;
                totalComissao += comissao;

                if(!v.cancelada) {
                    faturamentoAtivo += v.valor;
                    dadosGrafico[v.data] = (dadosGrafico[v.data] || 0) + v.valor;
                }

                corpo.innerHTML += `
                    <tr>
                        <td>${v.data}</td>
                        <td>
                            <b>${v.cliente}</b><br>
                            <span style="font-size:11px; color:#888">${v.tipo}</span> 
                            ${v.cancelada ? '<span class="tag tag-cancel">CANCELADA</span>' : '<span class="tag tag-ok">ATIVA</span>'}
                        </td>
                        <td style="${v.cancelada ? 'text-decoration:line-through; color:#999' : ''}">R$ ${v.valor.toLocaleString()}</td>
                        <td style="color: #00a344; font-weight: 800;">R$ ${comissao.toLocaleString()}</td>
                        <td>
                            <button class="btn-acao" onclick="toggleCancel(${i})">üö´</button>
                            <button class="btn-acao btn-del" onclick="deletar(${i})">üóëÔ∏è</button>
                        </td>
                    </tr>`;
            }
        });

        // Dashboard
        const saldoFinal = 2000 + totalComissao - totalVales;
        document.getElementById('fatDisplay').innerText = `R$ ${faturamentoAtivo.toLocaleString()}`;
        document.getElementById('saldoDisplay').innerText = `R$ ${saldoFinal.toLocaleString()}`;
        document.getElementById('valesDisplay').innerText = `R$ ${totalVales.toLocaleString()}`;
        document.getElementById('comissaoInfo').innerText = `Comiss√µes (3% de Tudo): R$ ${totalComissao.toLocaleString()}`;

        // Meta
        const pct = (faturamentoAtivo / metaMensal) * 100;
        document.getElementById('metaBarra').style.width = Math.min(pct, 100) + "%";
        document.getElementById('metaPct').innerText = Math.floor(pct) + "%";
        document.getElementById('metaStatus').innerText = `R$ ${faturamentoAtivo.toLocaleString()} de R$ ${metaMensal.toLocaleString()}`;

        atualizarGrafico(dadosGrafico);
    }

    function atualizarGrafico(dados) {
        const ctx = document.getElementById('graficoBonito').getContext('2d');
        if(chart) chart.destroy();
        
        let gradient = ctx.createLinearGradient(0, 0, 0, 200);
        gradient.addColorStop(0, 'rgba(0, 210, 255, 0.2)');
        gradient.addColorStop(1, 'rgba(0, 255, 136, 0)');

        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Object.keys(dados),
                datasets: [{
                    data: Object.values(dados),
                    borderColor: '#00d2ff',
                    borderWidth: 3,
                    pointRadius: 0, // Remove as bolinhas para ficar fluido
                    tension: 0.4,   // Curvatura bonita
                    fill: true,
                    backgroundColor: gradient
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { display: false } },
                    y: { border: { display: false }, ticks: { display: false }, grid: { color: '#f0f0f0' } }
                }
            }
        });
    }

    renderizar();
</script>
</body>
</html>
