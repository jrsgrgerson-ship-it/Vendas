<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MY BABY ULTIMATE | GERSON EDITION</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

    <style>
        :root {
            --primary: #2563eb;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg: #f8fafc;
            --card: #ffffff;
            --text-main: #0f172a;
            --text-sub: #64748b;
            --border: #e2e8f0;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg); 
            color: var(--text-main); 
            margin: 0; padding: 20px; 
            line-height: 1.5;
        }

        .container { max-width: 1000px; margin: auto; }

        /* HEADER */
        .header { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 30px; padding: 10px 0;
            border-bottom: 2px solid var(--border);
        }
        .header h1 { font-weight: 800; font-size: 24px; letter-spacing: -1px; margin: 0; }
        .header .date-now { color: var(--text-sub); font-size: 14px; font-weight: 600; }

        /* DASHBOARD GRID */
        .dashboard { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); 
            gap: 20px; margin-bottom: 30px; 
        }

        .card { 
            background: var(--card); border-radius: 16px; padding: 24px; 
            border: 1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        .card:hover { transform: translateY(-2px); }
        .card h3 { margin: 0; font-size: 12px; text-transform: uppercase; color: var(--text-sub); letter-spacing: 0.05em; }
        .card .value { margin: 12px 0 4px; font-size: 28px; font-weight: 800; display: block; }
        .card .sub-value { font-size: 12px; font-weight: 600; }

        .card-main { background: var(--text-main); color: #fff; border: none; }
        .card-main .value { color: var(--success); }
        .card-main h3 { color: #94a3b8; }

        /* CHART SECTION */
        .chart-section { 
            background: var(--card); border-radius: 16px; padding: 25px; 
            border: 1px solid var(--border); margin-bottom: 30px; height: 350px;
        }

        /* FORMUL√ÅRIO */
        .glass-form { 
            background: #fff; padding: 25px; border-radius: 16px; 
            border: 1px solid var(--border); margin-bottom: 30px;
            display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;
        }
        
        .input-group { display: flex; flex-direction: column; gap: 5px; }
        .input-group label { font-size: 12px; font-weight: 700; color: var(--text-sub); }
        
        input, select { 
            padding: 12px; border: 1px solid var(--border); border-radius: 8px; 
            font-size: 14px; font-family: inherit; transition: 0.2s;
        }
        input:focus { outline: none; border-color: var(--primary); ring: 2px rgba(37, 99, 235, 0.1); }

        .btn { 
            padding: 12px 24px; border-radius: 8px; font-weight: 700; cursor: pointer; 
            border: none; transition: 0.2s; font-size: 14px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #1d4ed8; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-sub); }
        .btn-outline:hover { background: #f1f5f9; color: var(--text-main); }
        .btn-danger { background: #fff1f2; color: var(--danger); border: 1px solid #fecaca; }

        /* TABELA DE VENDAS */
        .table-container { 
            background: var(--card); border-radius: 16px; border: 1px solid var(--border); overflow: hidden; 
        }
        table { width: 100%; border-collapse: collapse; text-align: left; }
        th { background: #f1f5f9; padding: 16px; font-size: 11px; text-transform: uppercase; color: var(--text-sub); font-weight: 800; }
        td { padding: 16px; border-bottom: 1px solid var(--border); font-size: 14px; vertical-align: middle; }
        
        tr.cancelled-row { background-color: #fdfdfd; }
        tr.cancelled-row td { color: #94a3b8; }
        .strike { text-decoration: line-through; opacity: 0.6; }

        .tag { padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 700; text-transform: uppercase; }
        .tag-success { background: #dcfce7; color: #166534; }
        .tag-error { background: #fee2e2; color: #991b1b; }
        .tag-vale { background: #fef3c7; color: #92400e; }

        .actions { display: flex; gap: 8px; justify-content: flex-end; }
        .btn-icon { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 6px; border: 1px solid var(--border); background: #fff; cursor: pointer; }
        .btn-icon:hover { background: #f8fafc; }

        @media (max-width: 600px) {
            .glass-form { grid-template-columns: 1fr; }
            .header { flex-direction: column; gap: 10px; text-align: center; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>MY BABY <span style="color:var(--primary)">ULTIMATE</span></h1>
        <div class="date-now" id="currentDate">--/--/----</div>
    </div>

    <div class="dashboard">
        <div class="card">
            <h3>Faturamento Mensal</h3>
            <span class="value" id="fatAtivo">R$ 0,00</span>
            <span class="sub-value" style="color:var(--success)" id="metaInfo">Calculando meta...</span>
        </div>
        <div class="card card-main">
            <h3>Saldo Gerson Final</h3>
            <span class="value" id="saldoGerson">R$ 0,00</span>
            <span class="sub-value" id="comisTotal">Inclui 3% de todas as vendas</span>
        </div>
        <div class="card">
            <h3>Total Vales</h3>
            <span class="value" style="color:var(--danger)" id="totalVales">R$ 0,00</span>
            <span class="sub-value" id="qtdVales">0 retiradas</span>
        </div>
    </div>

    <div class="chart-section">
        <canvas id="mainChart"></canvas>
    </div>

    <div class="glass-form">
        <div class="input-group">
            <label>Pet / Tipo</label>
            <select id="petType">
                <option value="Spitz Alem√£o">üê∂ Spitz Alem√£o</option>
                <option value="Gato Bengal">üê± Gato Bengal</option>
            </select>
        </div>
        <div class="input-group">
            <label>Nome do Cliente</label>
            <input type="text" id="clientName" placeholder="Ex: Jo√£o Silva">
        </div>
        <div class="input-group">
            <label>Valor da Venda</label>
            <input type="number" id="saleValue" placeholder="R$ 0,00">
        </div>
        <div class="input-group" style="justify-content: flex-end;">
            <button class="btn btn-primary" onclick="addSale()">LAN√áAR AGORA</button>
        </div>
    </div>

    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
        <button class="btn btn-outline" style="flex: 1;" onclick="addVale()">+ REGISTRAR VALE</button>
        <button class="btn btn-outline" onclick="generateReport()">üìÑ GERAR RELAT√ìRIO PDF</button>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Cliente / Detalhes</th>
                    <th>Valor Bruto</th>
                    <th>Minha Parte (3%)</th>
                    <th style="text-align: right;">A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="salesList"></tbody>
        </table>
    </div>

    <div style="margin-top: 30px; text-align: center; opacity: 0.5; font-size: 10px;">
        MY BABY SYSTEM V6.0 - GERSON EXCLUSIVE EDITION
    </div>
</div>

<script>
    // --- N√öCLEO DE DADOS ---
    let db = JSON.parse(localStorage.getItem('vendasV5')) || [];
    let chartInstance = null;
    const metaObjetivo = 74000;

    // Inicializar data
    document.getElementById('currentDate').innerText = new Date().toLocaleDateString('pt-BR', { dateStyle: 'long' });

    function save() {
        localStorage.setItem('vendasV5', JSON.stringify(db));
        render();
    }

    // --- FUN√á√ïES DE ADI√á√ÉO ---
    function addSale() {
        const name = document.getElementById('clientName').value;
        const val = parseFloat(document.getElementById('saleValue').value);
        const type = document.getElementById('petType').value;

        if(!name || !val) return alert("Preencha cliente e valor!");

        db.push({
            id: Date.now(),
            date: new Date().toLocaleDateString('pt-BR').substring(0, 5),
            client: name,
            type: type,
            value: val,
            isVale: false,
            cancelled: false
        });

        document.getElementById('clientName').value = '';
        document.getElementById('saleValue').value = '';
        save();
    }

    function addVale() {
        const val = prompt("Valor da Retirada / Vale:");
        if(!val || isNaN(val)) return;

        db.push({
            id: Date.now(),
            date: new Date().toLocaleDateString('pt-BR').substring(0, 5),
            client: "VALE / ADIANTAMENTO",
            value: parseFloat(val),
            isVale: true,
            cancelled: false
        });
        save();
    }

    function toggleCancel(id) {
        const idx = db.findIndex(item => item.id === id);
        db[idx].cancelled = !db[idx].cancelled;
        save();
    }

    function removeItem(id) {
        if(confirm("Deseja excluir permanentemente este registro?")) {
            db = db.filter(item => item.id !== id);
            save();
        }
    }

    // --- L√ìGICA DE RENDERIZA√á√ÉO E MATEM√ÅTICA ---
    function render() {
        const list = document.getElementById('salesList');
        list.innerHTML = '';
        
        let totalComissao = 0;
        let totalVales = 0;
        let faturamentoAtivo = 0;
        let countVales = 0;
        let chartData = {};

        // Loop Unificado e Seguro
        db.forEach(item => {
            if(item.isVale) {
                totalVales += item.value;
                countVales++;
            } else {
                // MATEM√ÅTICA INDESTRUT√çVEL: 3% de tudo que foi lan√ßado
                totalComissao += (item.value * 0.03);

                if(!item.cancelled) {
                    faturamentoAtivo += item.value;
                    chartData[item.date] = (chartData[item.date] || 0) + item.value;
                }
            }
        });

        const saldoGersonFinal = 2000 + totalComissao - totalVales;

        // Atualizar Dashboard
        document.getElementById('fatAtivo').innerText = `R$ ${faturamentoAtivo.toLocaleString('pt-BR')}`;
        document.getElementById('saldoGerson').innerText = `R$ ${saldoGersonFinal.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;
        document.getElementById('totalVales').innerText = `R$ ${totalVales.toLocaleString('pt-BR')}`;
        document.getElementById('qtdVales').innerText = `${countVales} retiradas no m√™s`;
        document.getElementById('comisTotal').innerText = `Total 3%: R$ ${totalComissao.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;

        // Atualizar Meta
        const pctMeta = (faturamentoAtivo / metaObjetivo) * 100;
        document.getElementById('metaInfo').innerText = `${Math.floor(pctMeta)}% da meta atingida`;

        // Gerar Lista na Tabela (Invertida)
        [...db].reverse().forEach(item => {
            if(item.isVale) {
                list.innerHTML += renderValeRow(item);
            } else {
                list.innerHTML += renderSaleRow(item);
            }
        });

        updateChart(chartData);
    }

    function renderSaleRow(v) {
        return `
            <tr class="${v.cancelled ? 'cancelled-row' : ''}">
                <td>${v.date}</td>
                <td>
                    <div style="font-weight:700">${v.client}</div>
                    <div style="font-size:11px; color:#64748b">${v.type}</div>
                    ${v.cancelled ? '<span class="tag tag-error">Cancelada</span>' : '<span class="tag tag-success">Ativa</span>'}
                </td>
                <td class="${v.cancelled ? 'strike' : ''}" style="font-weight:600">R$ ${v.value.toLocaleString()}</td>
                <td style="color:var(--success); font-weight:800">+ R$ ${(v.value * 0.03).toLocaleString('pt-BR', {minimumFractionDigits:2})}</td>
                <td>
                    <div class="actions">
                        <button class="btn-icon" title="Cancelar/Ativar" onclick="toggleCancel(${v.id})">üö´</button>
                        <button class="btn-icon btn-danger" title="Excluir" onclick="removeItem(${v.id})">üóëÔ∏è</button>
                    </div>
                </td>
            </tr>
        `;
    }

    function renderValeRow(v) {
        return `
            <tr style="background:#fffafa">
                <td>${v.date}</td>
                <td><span class="tag tag-vale">VALE / SAQUE</span></td>
                <td style="color:var(--danger); font-weight:700">- R$ ${v.value.toLocaleString()}</td>
                <td>--</td>
                <td>
                    <div class="actions">
                        <button class="btn-icon btn-danger" onclick="removeItem(${v.id})">üóëÔ∏è</button>
                    </div>
                </td>
            </tr>
        `;
    }

    // --- GR√ÅFICO PREMIUM ---
    function updateChart(map) {
        const ctx = document.getElementById('mainChart').getContext('2d');
        if(chartInstance) chartInstance.destroy();

        const labels = Object.keys(map);
        const data = Object.values(map);

        let gradient = ctx.createLinearGradient(0, 0, 0, 300);
        gradient.addColorStop(0, 'rgba(37, 99, 235, 0.1)');
        gradient.addColorStop(1, 'rgba(37, 99, 235, 0)');

        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Vendas Di√°rias',
                    data: data,
                    borderColor: '#2563eb',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    backgroundColor: gradient,
                    pointRadius: 4,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#2563eb',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, grid: { color: '#f1f5f9' }, border: { display: false } },
                    x: { grid: { display: false } }
                }
            }
        });
    }

    // --- RELAT√ìRIO PDF PROFISSIONAL ---
    function generateReport() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        doc.setFontSize(20);
        doc.text("Relat√≥rio Mensal My Baby", 14, 20);
        
        doc.setFontSize(10);
        doc.text(`Gerado em: ${new Date().toLocaleString()}`, 14, 28);

        // Resumo
        const totalC = db.reduce((acc, v) => acc + (v.isVale ? 0 : v.value * 0.03), 0);
        const totalV = db.reduce((acc, v) => acc + (v.isVale ? v.value : 0), 0);
        const saldo = 2000 + totalC - totalV;

        doc.autoTable({
            startY: 35,
            head: [['Descri√ß√£o', 'Valor']],
            body: [
                ['Sal√°rio Fixo', 'R$ 2.000,00'],
                ['Total Comiss√µes (3%)', `R$ ${totalC.toFixed(2)}`],
                ['Total Vales/Retiradas', `R$ ${totalV.toFixed(2)}`],
                ['SALDO L√çQUIDO FINAL', `R$ ${saldo.toFixed(2)}`]
            ],
            theme: 'grid',
            headStyles: { fillStyle: '#2563eb' }
        });

        doc.save(`Fechamento_My_Baby_${Date.now()}.pdf`);
    }

    // Ligar o motor
    render();
</script>
</body>
</html>
