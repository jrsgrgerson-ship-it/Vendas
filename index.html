<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SISTEMA GERSON - RECUPERA√á√ÉO TOTAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --neon: #00f2ff; --green: #00ff88; --bg: #000000; --card: #0d0d0d; }
        body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; margin: 0; padding: 15px; }
        .container { max-width: 450px; margin: auto; }
        
        /* HEADER NEON */
        header { border-left: 5px solid var(--neon); padding-left: 15px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        header h1 { margin: 0; font-size: 20px; font-weight: 900; text-transform: uppercase; letter-spacing: -1px; }
        
        .main-card { background: var(--card); border-radius: 25px; padding: 25px; border: 1px solid #222; box-shadow: 0 0 30px rgba(0, 242, 255, 0.05); text-align: center; margin-bottom: 15px; }
        .big-val { font-size: 40px; font-weight: 900; display: block; margin: 10px 0; color: #fff; }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .s-box { background: var(--card); padding: 15px; border-radius: 15px; border: 1px solid #1a1a1a; }
        .s-box span { font-size: 10px; color: #666; font-weight: 800; display: block; margin-bottom: 5px; }
        .s-box b { font-size: 18px; color: var(--green); }

        .item { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 8px; border: 1px solid #111; display: flex; justify-content: space-between; align-items: center; }
        .item b { font-size: 14px; text-transform: uppercase; display: block; }
        .item small { color: #555; font-size: 10px; }
        .item .val { font-weight: 900; color: var(--neon); }

        .btn-main { background: #fff; color: #000; border: none; padding: 16px; border-radius: 15px; width: 100%; font-weight: 900; cursor: pointer; margin-top: 10px; }
        input, select { background: #080808; border: 1px solid #222; color: #fff; padding: 12px; border-radius: 12px; width: 100%; margin-bottom: 8px; box-sizing: border-box; }
        
        .debug-btn { background: #111; color: #444; border: none; font-size: 10px; padding: 10px; border-radius: 10px; width: 100%; margin-top: 20px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <span style="font-size: 10px; color: var(--neon); font-weight: 800;">PAINEL VENDEDOR</span>
            <h1>GERSON</h1>
        </div>
        <div style="text-align: right; font-size: 9px; color: #444;">V6 STABLE</div>
    </header>

    <div class="main-card">
        <span style="font-size: 11px; color: #666; font-weight: 800; letter-spacing: 1px;">FATURAMENTO TOTAL</span>
        <strong class="big-val" id="totalVendas">R$ 0</strong>
        <div style="height: 80px;"><canvas id="grafico"></canvas></div>
    </div>

    <div class="stat-grid">
        <div class="s-box">
            <span>SALDO (3% + 2k)</span>
            <b id="saldoGerson">R$ 0,00</b>
        </div>
        <div class="s-box">
            <span>DADOS RECUPERADOS</span>
            <b id="statusRec" style="color: var(--neon); font-size: 12px;">Buscando...</b>
        </div>
    </div>

    <div class="main-card" style="text-align: left;">
        <div style="display:flex; gap:5px;">
            <select id="tipo"><option value="Spitz">Spitz üê∂</option><option value="Bengal">Bengal üê±</option></select>
            <select id="sexo"><option value="Macho">Macho ‚ôÇ</option><option value="F√™mea">F√™mea ‚ôÄ</option></select>
        </div>
        <input type="text" id="cliente" placeholder="Nome do Cliente">
        <input type="number" id="valor" placeholder="Valor R$">
        <button class="btn-main" onclick="addVenda()">REGISTRAR VENDA</button>
    </div>

    <div id="listaVendas"></div>
    
    <button class="debug-btn" onclick="varrerMemorias()">N√ÉO APARECEU? CLIQUE AQUI PARA VARRER TUDO</button>
</div>

<script>
    let chartInstance = null;
    let vendas = [];

    // --- A SUPER VARREDURA ---
    function varrerMemorias() {
        // Lista de todas as gavetas que j√° usamos
        const gavetas = [
            'vendasV12', 'vendasV5', 'mybaby_v1', 'vendas_final_v1', 
            'vendas_backup', 'vendas_gerson', 'vendas_v10', 'vendas'
        ];
        
        let maiorLote = [];
        let maiorValor = -1;
        let gavetaEncontrada = "Nenhuma";

        gavetas.forEach(gaveta => {
            let item = localStorage.getItem(gaveta);
            if (item) {
                try {
                    let lista = JSON.parse(item);
                    if (Array.isArray(lista) && lista.length > 0) {
                        let soma = lista.reduce((a, b) => a + (b.valor || 0), 0);
                        if (soma > maiorValor) {
                            maiorValor = soma;
                            maiorLote = lista;
                            gavetaEncontrada = gaveta;
                        }
                    }
                } catch(e) {}
            }
        });

        if (maiorLote.length > 0) {
            vendas = maiorLote;
            document.getElementById('statusRec').innerText = "Gaveta: " + gavetaEncontrada;
            salvar(); // Consolida na gaveta principal
        } else {
            document.getElementById('statusRec').innerText = "Vazio";
        }
        renderizar();
    }

    function salvar() {
        // Salva na gaveta oficial e cria um backup
        localStorage.setItem('vendasV12', JSON.stringify(vendas));
        localStorage.setItem('vendas_backup_seguro', JSON.stringify(vendas));
        renderizar();
    }

    function addVenda() {
        const c = document.getElementById('cliente').value, v = parseFloat(document.getElementById('valor').value);
        if (c && v) {
            vendas.push({
                id: Date.now(),
                cliente: c,
                valor: v,
                tipo: document.getElementById('tipo').value,
                sexo: document.getElementById('sexo').value,
                data: new Date().toLocaleDateString('pt-BR')
            });
            document.getElementById('cliente').value = '';
            document.getElementById('valor').value = '';
            salvar();
        }
    }

    function renderizar() {
        const lista = document.getElementById('listaVendas');
        lista.innerHTML = '';
        let total = 0;
        let hist = {};

        // Mostra do mais novo para o mais antigo
        [...vendas].reverse().forEach(v => {
            total += v.valor;
            let dia = v.data.substring(0, 5);
            hist[dia] = (hist[dia] || 0) + v.valor;

            lista.innerHTML += `
                <div class="item">
                    <div>
                        <b>${v.cliente}</b>
                        <small>${v.data} | ${v.tipo} ${v.sexo}</small>
                    </div>
                    <div class="val">R$ ${v.valor.toLocaleString()}</div>
                </div>
            `;
        });

        document.getElementById('totalVendas').innerText = "R$ " + total.toLocaleString();
        document.getElementById('saldoGerson').innerText = "R$ " + ((total * 0.03) + 2000).toLocaleString('pt-BR', {minimumFractionDigits: 2});

        const ctx = document.getElementById('grafico').getContext('2d');
        if (chartInstance) chartInstance.destroy();
        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Object.keys(hist),
                datasets: [{
                    data: Object.values(hist),
                    borderColor: '#00f2ff',
                    borderWidth: 2,
                    fill: true,
                    backgroundColor: 'rgba(0, 242, 255, 0.05)',
                    tension: 0.4,
                    pointRadius: 0
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
        });
    }

    // Tenta carregar assim que abre
    varrerMemorias();
</script>
</body>
</html>
