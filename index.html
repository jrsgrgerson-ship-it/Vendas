<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MY BABY | NEON LUXE</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            /* PALETA BLUE NEON LUXE */
            --bg-deep: #050a14;
            --bg-panel: #0a1120;
            
            /* O Azul Claro "Chique" */
            --neon-blue: #00f2ff; 
            --neon-glow: 0 0 15px rgba(0, 242, 255, 0.4);
            
            --text-main: #ffffff;
            --text-dim: #8892b0;
            
            --danger: #ff2a6d; /* Rosa Neon para descontos */
            --border: 1px solid rgba(0, 242, 255, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; }
        
        body { 
            background: var(--bg-deep); 
            color: var(--text-main); 
            padding: 20px;
            min-height: 100vh;
            background-image: radial-gradient(circle at 50% 0%, #112240 0%, #050a14 70%);
        }

        .container { max-width: 1100px; margin: 0 auto; }

        /* HEADER */
        header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 40px; padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        h1 { 
            font-weight: 200; font-size: 28px; letter-spacing: 2px; text-transform: uppercase; 
        }
        h1 span { 
            font-weight: 800; color: var(--neon-blue); text-shadow: var(--neon-glow);
        }

        .actions button {
            background: transparent; border: var(--border); color: var(--neon-blue);
            padding: 8px 16px; border-radius: 4px; cursor: pointer;
            font-size: 11px; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s;
        }
        .actions button:hover {
            background: var(--neon-blue); color: #000; box-shadow: var(--neon-glow);
        }

        /* CARDS */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 40px; }
        
        .card {
            background: rgba(10, 17, 32, 0.6);
            backdrop-filter: blur(10px);
            border: var(--border);
            padding: 30px; border-radius: 12px;
            position: relative; overflow: hidden;
            transition: transform 0.3s;
        }
        .card:hover { transform: translateY(-5px); border-color: var(--neon-blue); }
        
        .card h3 { 
            font-size: 10px; text-transform: uppercase; letter-spacing: 2px; 
            color: var(--text-dim); margin-bottom: 10px; 
        }
        .card .value { font-size: 32px; font-weight: 600; display: block; margin-bottom: 5px; }
        .card small { font-size: 12px; opacity: 0.5; font-weight: 200; }

        /* Cores dos Cards */
        .c-vendas .value { color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.2); }
        .c-desc { border-color: rgba(255, 42, 109, 0.2); }
        .c-desc .value { color: var(--danger); text-shadow: 0 0 10px rgba(255, 42, 109, 0.3); }
        
        .c-final { 
            background: linear-gradient(135deg, rgba(0,242,255,0.05), transparent); 
            border: 1px solid var(--neon-blue); 
        }
        .c-final .value { color: var(--neon-blue); text-shadow: var(--neon-glow); }

        /* GR√ÅFICO */
        .chart-box {
            background: var(--bg-panel); border: var(--border); border-radius: 12px;
            padding: 20px; height: 300px; margin-bottom: 40px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        /* INPUTS */
        .control-bar {
            background: var(--bg-panel); padding: 15px; border-radius: 12px;
            display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap;
            border: var(--border);
        }
        input, select {
            background: #050a14; border: 1px solid #333; color: #fff;
            padding: 12px; border-radius: 6px; outline: none; font-size: 14px;
        }
        input:focus { border-color: var(--neon-blue); box-shadow: var(--neon-glow); }

        .btn-lancar {
            background: var(--neon-blue); color: #000; font-weight: 800; border: none;
            padding: 12px 25px; border-radius: 6px; cursor: pointer; flex-grow: 1;
            text-transform: uppercase; letter-spacing: 1px; transition: 0.3s;
        }
        .btn-lancar:hover { box-shadow: var(--neon-glow); }

        .btn-vale {
            background: transparent; color: var(--danger); border: 1px solid var(--danger);
            padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: 700;
        }
        .btn-vale:hover { background: var(--danger); color: #fff; box-shadow: 0 0 10px var(--danger); }

        /* TABELA */
        .table-wrap { border: var(--border); border-radius: 12px; overflow: hidden; }
        table { width: 100%; border-collapse: collapse; background: var(--bg-panel); }
        th { text-align: left; padding: 20px; color: var(--text-dim); font-size: 10px; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #222; }
        td { padding: 20px; border-bottom: 1px solid #1a2639; font-size: 14px; color: #fff; }
        
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 9px; text-transform: uppercase; letter-spacing: 1px; }
        .b-azul { border: 1px solid var(--neon-blue); color: var(--neon-blue); }
        .b-rosa { border: 1px solid var(--danger); color: var(--danger); }
        .b-sinal { border: 1px solid #f39c12; color: #f39c12; }

        /* Especiais */
        .row-vale td { color: var(--danger); opacity: 0.8; }
        .row-cancel td { opacity: 0.6; }
        .strike { text-decoration: line-through; opacity: 0.5; margin-right: 5px; }

        .del-btn { background: none; border: none; color: #444; cursor: pointer; font-size: 14px; transition: 0.2s; }
        .del-btn:hover { color: var(--danger); }

        @media print {
            body { background: #fff; color: #000; background-image: none; }
            .no-print { display: none; }
            .card, .table-wrap, .chart-box { border: 1px solid #000; background: #fff; color: #000; box-shadow: none; }
            .value { color: #000 !important; text-shadow: none !important; }
            h1 span { color: #000; text-shadow: none; }
        }
    </style>
</head>
<body>

<div class="container">
    <header class="no-print">
        <h1>MY BABY <span>LUXE V21</span></h1>
        <div class="actions">
            <button onclick="recuperarDados()">üîÑ Buscar Dados (74k)</button>
            <button onclick="exportar()">üíæ Backup</button>
            <button onclick="window.print()">üñ®Ô∏è PDF</button>
        </div>
    </header>

    <div class="grid">
        <div class="card c-vendas">
            <h3>Faturamento Bruto</h3>
            <span class="value" id="disp-fat">R$ 0,00</span>
            <small id="disp-qtd">0 Vendas (Entregues + Sinais)</small>
        </div>
        <div class="card c-desc">
            <h3>Total Descontos</h3>
            <span class="value" id="disp-desc">R$ 0,00</span>
            <small>Vales e Adiantamentos</small>
        </div>
        <div class="card c-final">
            <h3>A RECEBER (L√çQUIDO)</h3>
            <span class="value" id="disp-final">R$ 0,00</span>
            <small>Fixo (2k) + 3% Comiss√£o - Vales</small>
        </div>
    </div>

    <div class="chart-box no-print">
        <canvas id="neonChart"></canvas>
    </div>

    <div class="control-bar no-print">
        <select id="inRaca"><option>Spitz</option><option>Bengal</option><option>Outros</option></select>
        <select id="inSexo"><option value="M">Macho</option><option value="F">F√™mea</option></select>
        <input type="text" id="inCli" placeholder="Nome do Cliente" style="flex-grow:1">
        <input type="number" id="inVal" placeholder="Valor (R$)" style="width:120px">
        <button class="btn-lancar" onclick="add(false)">Lan√ßar Venda</button>
        <button class="btn-vale" onclick="add(true)">Registrar Vale</button>
    </div>

    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Status</th>
                    <th>Detalhes</th>
                    <th>Valor</th>
                    <th>Comiss√£o (3%)</th>
                    <th class="no-print" style="text-align:right"></th>
                </tr>
            </thead>
            <tbody id="lista"></tbody>
        </table>
    </div>
</div>

<script>
    const STORAGE_KEY = 'MYBABY_LUXE_V21';
    let db = { vendas: [] };
    let myChart = null;

    // --- RECUPERA√á√ÉO AGRESSIVA (GARANTINDO OS 74K) ---
    function recuperarDados() {
        if(!confirm("Escanear mem√≥ria do navegador para recuperar dados antigos?")) return;
        
        let allItems = [];
        // Varre TUDO
        for(let i=0; i<localStorage.length; i++) {
            let k = localStorage.key(i);
            try {
                let val = JSON.parse(localStorage.getItem(k));
                let arr = null;
                // Detecta se √© lista direta ou objeto com lista
                if(Array.isArray(val)) arr = val;
                else if(val.vendas && Array.isArray(val.vendas)) arr = val.vendas;

                if(arr) {
                    arr.forEach(item => {
                        // Normaliza√ß√£o for√ßada
                        if(item.vale === true || item.vale === "true") item.tipo = 'vale';
                        if(!item.tipo && item.valor) item.tipo = 'venda';
                        allItems.push(item);
                    });
                }
            } catch(e) {}
        }

        // Deduplica√ß√£o Inteligente
        let clean = [];
        let signatures = new Set();
        allItems.forEach(i => {
            // Assinatura √∫nica: Data + Cliente + Valor
            let sig = (i.data||'') + (i.cliente||'') + (i.valor||'');
            if(sig.length > 3 && !signatures.has(sig)) {
                signatures.add(sig);
                // Garante ID
                if(!i.id) i.id = Date.now() + Math.random();
                clean.push(i);
            }
        });

        if(clean.length > 0) {
            db.vendas = clean;
            save();
            alert(`Recupera√ß√£o completa: ${clean.length} registros encontrados.`);
        } else {
            alert("Nenhum dado encontrado.");
        }
    }

    // --- SISTEMA CORE ---
    function init() {
        let saved = localStorage.getItem(STORAGE_KEY);
        if(saved) {
            db = JSON.parse(saved);
        } else {
            // Se n√£o tiver dados V21, tenta recuperar automaticamente
            recuperarDados(); 
        }
        render();
    }

    function save() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
        render();
    }

    function add(isVale) {
        let cli = document.getElementById('inCli').value;
        let val = parseFloat(document.getElementById('inVal').value);
        if(isVale && !val) val = parseFloat(prompt("Valor do Vale:"));
        
        if(val) {
            db.vendas.push({
                id: Date.now(),
                data: new Date().toLocaleDateString('pt-BR').substring(0,5),
                tipo: isVale ? 'vale' : 'venda',
                cliente: isVale ? 'ADIANTAMENTO' : (cli || 'Cliente'),
                raca: document.getElementById('inRaca').value,
                sexo: document.getElementById('inSexo').value,
                valor: val,
                cancelada: false
            });
            document.getElementById('inCli').value = '';
            document.getElementById('inVal').value = '';
            save();
        }
    }

    function toggle(id) {
        let item = db.vendas.find(x => x.id == id);
        if(item) { item.cancelada = !item.cancelada; save(); }
    }

    function del(id) {
        if(confirm("Apagar?")) {
            db.vendas = db.vendas.filter(x => x.id != id);
            save();
        }
    }

    // --- RENDERIZADOR ---
    function render() {
        let tbody = document.getElementById('lista');
        tbody.innerHTML = '';

        let fat = 0;
        let desc = 0;
        let comissao = 0;
        let labels = [];
        let dataPts = [];

        // Ordena para gr√°fico (Crescente)
        let sorted = [...db.vendas].sort((a,b) => a.id - b.id);

        sorted.forEach(v => {
            if(v.tipo === 'vale') {
                desc += v.valor;
            } else {
                // REGRA: Venda ou Cancelada(Sinal) -> Soma tudo
                fat += v.valor;
                comissao += (v.valor * 0.03);
                
                labels.push(v.data);
                dataPts.push(v.valor);
            }
        });

        // Cards Update
        document.getElementById('disp-fat').innerText = `R$ ${fat.toLocaleString('pt-BR')}`;
        document.getElementById('disp-qtd').innerText = `${sorted.filter(x=>x.tipo!='vale').length} Registros`;
        document.getElementById('disp-desc').innerText = `R$ ${desc.toLocaleString('pt-BR')}`;
        
        // Saldo Final = Fixo + Comissao - Vales
        let saldo = 2000 + comissao - desc;
        document.getElementById('disp-final').innerText = `R$ ${saldo.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;

        // Tabela (Decrescente)
        [...sorted].reverse().forEach(v => {
            let tr = document.createElement('tr');
            
            if(v.tipo === 'vale') {
                tr.className = 'row-vale';
                tr.innerHTML = `
                    <td>${v.data}</td>
                    <td><span class="badge b-rosa">VALE</span></td>
                    <td>ADIANTAMENTO</td>
                    <td>- R$ ${v.valor.toLocaleString()}</td>
                    <td>-</td>
                    <td class="no-print" style="text-align:right"><button class="del-btn" onclick="del(${v.id})">‚úï</button></td>
                `;
            } else {
                let isCancel = v.cancelada;
                let st = isCancel ? '<span class="badge b-sinal">SINAL/CANCEL</span>' : '<span class="badge b-azul">ENTREGUE</span>';
                let valShow = isCancel ? `<span class="strike">R$ ${v.valor.toLocaleString()}</span> (Sinal)` : `R$ ${v.valor.toLocaleString()}`;
                if(isCancel) tr.className = 'row-cancel';

                tr.innerHTML = `
                    <td>${v.data}</td>
                    <td>${st}</td>
                    <td><b>${v.cliente}</b> <span style="opacity:0.5; font-size:10px">| ${v.raca}</span></td>
                    <td>${valShow}</td>
                    <td style="color:var(--neon-blue)">+ R$ ${(v.valor * 0.03).toLocaleString('pt-BR', {minimumFractionDigits:2})}</td>
                    <td class="no-print" style="text-align:right">
                        <button class="del-btn" style="margin-right:10px" onclick="toggle(${v.id})">‚Ü∫</button>
                        <button class="del-btn" onclick="del(${v.id})">‚úï</button>
                    </td>
                `;
            }
            tbody.appendChild(tr);
        });

        drawChart(labels, dataPts);
    }

    function drawChart(lbls, vals) {
        const ctx = document.getElementById('neonChart').getContext('2d');
        if(myChart) myChart.destroy();

        // Gradiente Neon
        let gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(0, 242, 255, 0.5)'); // Azul forte no topo
        gradient.addColorStop(1, 'rgba(0, 242, 255, 0)');   // Transparente embaixo

        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: lbls,
                datasets: [{
                    label: 'Vendas',
                    data: vals,
                    borderColor: '#00f2ff', // Linha Azul Neon
                    borderWidth: 2,
                    backgroundColor: gradient,
                    fill: true,
                    tension: 0.4, // Curva suave (ondas)
                    pointRadius: 0, // ZERO BOLINHAS (Como pedido)
                    pointHoverRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { display: false }, ticks: { color: '#8892b0' } },
                    y: { 
                        grid: { color: 'rgba(255,255,255,0.05)' }, 
                        ticks: { color: '#8892b0' },
                        beginAtZero: true
                    }
                },
                animation: {
                    duration: 1500,
                    easing: 'easeOutQuart'
                }
            }
        });
    }

    function exportar() {
        let blob = new Blob([JSON.stringify(db)], {type: "application/json"});
        let a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `Backup_Luxe_${new Date().toLocaleDateString().replace(/\//g,'-')}.json`;
        a.click();
    }

    // Start
    init();
</script>

</body>
</html>
