<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MY BABY | RESGATE TOTAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #00d2ff;     /* Azul Neon */
            --success: #00ff88;     /* Verde Neon */
            --danger: #ff004c;      /* Vermelho Neon */
            --bg: #000000;          /* Preto Fundo */
            --glass: rgba(25, 25, 25, 0.8);
            --border: 1px solid #333;
        }

        body { 
            background: var(--bg); color: #fff; font-family: 'Inter', sans-serif;
            margin: 0; padding: 15px; min-height: 100vh;
        }

        .container { max-width: 450px; margin: auto; }

        header { text-align: center; margin-bottom: 20px; }
        .brand { font-size: 22px; font-weight: 900; color: var(--primary); text-transform: uppercase; letter-spacing: 2px; }

        /* CARDS */
        .card { 
            background: var(--glass); border-radius: 15px; padding: 15px; 
            margin-bottom: 12px; border: var(--border);
        }

        /* PAINEL FINANCEIRO */
        .painel-saldo { border-left: 4px solid var(--success); }
        .painel-vale { border-left: 4px solid var(--danger); }
        
        .lbl { font-size: 10px; font-weight: 700; text-transform: uppercase; color: #888; display: block; }
        .val-big { font-size: 24px; font-weight: 900; display: block; margin-top: 2px; }
        .txt-green { color: var(--success); }
        .txt-red { color: var(--danger); }

        /* LISTA */
        .item { 
            display: grid; grid-template-columns: 40px 1fr auto; gap: 10px; 
            padding: 12px; border-bottom: 1px solid #222; align-items: center;
        }
        .item:last-child { border-bottom: none; }
        .icon { font-size: 20px; }
        .info b { font-size: 13px; display: block; color: #fff; }
        .info span { font-size: 10px; color: #777; }
        
        .money { text-align: right; }
        .comissao { color: var(--success); font-weight: 700; font-size: 11px; display: block; }
        .bruto { font-size: 10px; color: #555; }
        
        .cancelled { opacity: 0.6; }
        .cancelled .bruto { text-decoration: line-through; }
        
        .tag-cancel { color: var(--danger); font-size: 9px; font-weight: 900; }
        .tag-ok { color: var(--success); font-size: 9px; font-weight: 900; }

        /* INPUTS */
        input, select { 
            background: #111; border: 1px solid #333; color: #fff; 
            padding: 12px; border-radius: 8px; width: 100%; margin-bottom: 8px; 
            font-size: 14px; outline: none; box-sizing: border-box;
        }
        .btn { 
            background: var(--primary); color: #000; border: none; padding: 15px; 
            border-radius: 8px; font-weight: 900; width: 100%; text-transform: uppercase; cursor: pointer;
        }
        .btn-mini { width: 30px; height: 30px; border-radius: 6px; border: 1px solid #333; background: #000; color: #fff; cursor: pointer; margin-left: 4px; }
    </style>
</head>
<body>

<div class="container">
    <header><div class="brand">MY BABY SYSTEM</div></header>

    <div class="card painel-saldo">
        <span class="lbl">Saldo Final (Fixo + 3%)</span>
        <span class="val-big txt-green" id="saldoFinal">R$ 0,00</span>
        <span class="lbl" style="margin-top:5px; color:#555;" id="comissaoTotal">Comiss√£o: R$ 0,00</span>
    </div>

    <div class="card painel-vale">
        <span class="lbl">Vales e Retiradas</span>
        <span class="val-big txt-red" id="totalVales">R$ 0,00</span>
    </div>

    <div class="card">
        <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
            <span class="lbl">META MENSAL</span>
            <input type="number" id="metaVal" onchange="salvarMeta()" style="width:100px; border:none; background:transparent; text-align:right; color:#fff; font-weight:900;">
        </div>
        <div style="background:#222; height:6px; border-radius:10px; overflow:hidden;">
            <div id="barraProgresso" style="width:0%; height:100%; background:var(--primary); transition:1s;"></div>
        </div>
        <div style="text-align:right; font-size:10px; color:#777; margin-top:5px;" id="faltaMeta">Falta R$ 0,00</div>
    </div>

    <div class="card">
        <div style="display:flex; gap:5px;">
            <select id="selTipo"><option value="Spitz">üê∂ Spitz</option><option value="Bengal">üê± Bengal</option></select>
            <select id="selSexo"><option value="Macho">‚ôÇ Macho</option><option value="F√™mea">‚ôÄ F√™mea</option></select>
        </div>
        <input type="text" id="inCliente" placeholder="Nome do Cliente">
        <input type="number" id="inValor" placeholder="Valor R$">
        <button class="btn" onclick="addVenda()">LAN√áAR VENDA</button>
        <button onclick="addVale()" style="background:none; border:none; color:var(--danger); width:100%; margin-top:10px; font-weight:800; cursor:pointer;">REGISTRAR VALE</button>
    </div>

    <div class="card" style="padding:0;" id="listaDiv"></div>

    <button onclick="fazerBackup()" style="background:#222; color:#fff; padding:10px; border:1px solid #333; width:100%; border-radius:8px; margin-top:20px;">SALVAR BACKUP AGORA</button>
    <button onclick="restaurarBackup()" style="background:#222; color:#fff; padding:10px; border:1px solid #333; width:100%; border-radius:8px; margin-top:10px;">IMPORTAR BACKUP</button>
</div>

<script>
    // --- O SEGREDO DO RESGATE: VOLTAR PARA 'vendasV5' ---
    let vendas = JSON.parse(localStorage.getItem('vendasV5')) || [];
    let meta = localStorage.getItem('metaV5') || 0;
    
    document.getElementById('metaVal').value = meta;
    render();

    function salvarTudo() {
        localStorage.setItem('vendasV5', JSON.stringify(vendas));
        localStorage.setItem('metaV5', meta);
        render();
    }

    function salvarMeta() {
        meta = document.getElementById('metaVal').value;
        salvarTudo();
    }

    function addVenda() {
        let cli = document.getElementById('inCliente').value;
        let val = parseFloat(document.getElementById('inValor').value);
        if(cli && val) {
            vendas.push({
                tipo: document.getElementById('selTipo').value,
                cliente: cli,
                valor: val,
                data: new Date().toLocaleDateString('pt-BR'),
                cancelada: false,
                entregue: false,
                sinal: 0,
                isVale: false
            });
            document.getElementById('inCliente').value = '';
            document.getElementById('inValor').value = '';
            salvarTudo();
        }
    }

    function addVale() {
        let val = prompt("Valor do Vale:");
        if(val) {
            vendas.push({
                cliente: 'VALE',
                valor: parseFloat(val),
                data: new Date().toLocaleDateString('pt-BR'),
                isVale: true
            });
            salvarTudo();
        }
    }

    function acao(index, tipo) {
        if(tipo === 'del') {
            if(confirm("Apagar item?")) vendas.splice(index, 1);
        }
        else if(tipo === 'cancel') {
            if(!vendas[index].cancelada) {
                let s = prompt("Valor do Sinal (Informativo):", 0);
                vendas[index].sinal = s;
            }
            vendas[index].cancelada = !vendas[index].cancelada;
        }
        else if(tipo === 'home') {
            vendas[index].entregue = !vendas[index].entregue;
        }
        salvarTudo();
    }

    function render() {
        let lista = document.getElementById('listaDiv');
        lista.innerHTML = '';
        
        let somaComissao = 0;
        let somaVales = 0;
        let faturamentoReal = 0; // Para meta

        // O LOOP PERFEITO
        vendas.forEach((v, i) => {
            if(v.isVale) {
                somaVales += v.valor;
                lista.innerHTML = `
                <div class="item" style="border-left:3px solid var(--danger)">
                    <div style="font-size:20px">üí∏</div>
                    <div class="info"><b>VALE / SAQUE</b><span>${v.data}</span></div>
                    <div class="money">
                        <b style="color:var(--danger)">- R$ ${v.valor.toLocaleString()}</b>
                        <br><button onclick="acao(${i}, 'del')" style="border:none; background:none; color:#888;">‚úï</button>
                    </div>
                </div>` + lista.innerHTML;
            } else {
                // MATEM√ÅTICA: SOMA SEMPRE 3% (N√£o importa se cancelou)
                somaComissao += (v.valor * 0.03);

                if(!v.cancelada) faturamentoReal += v.valor;

                let icone = v.tipo === 'Spitz' ? 'üê∂' : 'üê±';
                let status = v.cancelada ? `<span class="tag-cancel">CANCELADA (Sinal ${v.sinal||0})</span>` : (v.entregue ? '<span class="tag-ok">ENTREGUE</span>' : '');

                lista.innerHTML = `
                <div class="item ${v.cancelada ? 'cancelled' : ''}">
                    <div class="icon">${icone}</div>
                    <div class="info">
                        <b>${v.cliente}</b>
                        <span>${v.tipo} | ${v.data}</span>
                        ${status}
                    </div>
                    <div class="money">
                        <span class="comissao">+ R$ ${(v.valor * 0.03).toLocaleString()}</span>
                        <span class="bruto">R$ ${v.valor.toLocaleString()}</span>
                        <div style="margin-top:5px;">
                            <button class="btn-mini" onclick="acao(${i}, 'home')" style="${v.entregue?'background:#2ecc71':''}">üè†</button>
                            <button class="btn-mini" onclick="acao(${i}, 'cancel')" style="${v.cancelada?'background:#ff4757':''}">üö´</button>
                            <button class="btn-mini" onclick="acao(${i}, 'del')">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>` + lista.innerHTML;
            }
        });

        // TOTAIS
        let saldo = 2000 + somaComissao - somaVales;
        
        document.getElementById('saldoFinal').innerText = "R$ " + saldo.toLocaleString('pt-BR', {minimumFractionDigits: 2});
        document.getElementById('totalVales').innerText = "R$ " + somaVales.toLocaleString('pt-BR', {minimumFractionDigits: 2});
        document.getElementById('comissaoTotal').innerText = "Comiss√µes (3% de Tudo): R$ " + somaComissao.toLocaleString('pt-BR', {minimumFractionDigits: 2});

        // META
        let pct = meta > 0 ? (faturamentoReal / meta) * 100 : 0;
        document.getElementById('barraProgresso').style.width = Math.min(pct, 100) + "%";
        document.getElementById('faltaMeta').innerText = (meta - faturamentoReal) > 0 ? "Falta R$ " + (meta - faturamentoReal).toLocaleString() : "META BATIDA!";
    }

    function fazerBackup() {
        const data = JSON.stringify({ vendas, meta });
        const blob = new Blob([data], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'backup_vendas.json';
        a.click();
    }

    function restaurarBackup() {
        const input = document.createElement('input');
        input.type = 'file';
        input.onchange = e => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = event => {
                const dados = JSON.parse(event.target.result);
                vendas = dados.vendas || [];
                meta = dados.meta || 0;
                salvarTudo();
            };
            reader.readAsText(file);
        };
        input.click();
    }
</script>
</body>
</html>
